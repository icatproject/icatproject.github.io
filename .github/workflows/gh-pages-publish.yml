name: GitHub Pages Publish

on:
  pull_request:
  # By default, the pull_request event type is not triggered when a PR is merged into gatsbyjs
  push:
    branches:
      - gatsbyjs

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@ac593985615ec2ede58e132d2e21d2b1cbd6127c # v3.3.0
      - name: ${{ github.ref != 'refs/heads/gatsbyjs' && 'Build site' || 'Build and publish site' }}
        uses: enriikke/gatsby-gh-pages-action@fbe063b0cfaa8c16ec4e346cc3c48e9b154cce87 # v2.2.0
        with:
          access-token: x-access-token:${{ secrets.GITHUB_TOKEN }}
          # Publish the site only if merging into gatsbyjs branch
          skip-publish: ${{ github.ref != 'refs/heads/gatsbyjs' }}
          deploy-branch: master
